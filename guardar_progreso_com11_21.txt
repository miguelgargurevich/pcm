
      // Com11 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 11) {
        console.log('guardarProgreso Com11:', formData.recordId11);
        
        // Upload PDF if needed
        let pdfAportacionUrl = formData.pdfAportacion || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfAportacionUrl = await uploadPDF(pdfFile, `com11_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom11 = {
          entidadId,
          ...formData,
          pdfAportacion: pdfAportacionUrl
        };

        if (formData.recordId11) {
          // Update existing
          const updatedRecord = await com11AportacionGeoPeruService.update(formData.recordId11, dataCom11);
          console.log('Com11 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com11AportacionGeoPeruService.create(dataCom11);
          console.log('Com11 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId11: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com12 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 12) {
        console.log('guardarProgreso Com12:', formData.recordId12);
        
        // Upload PDF if needed
        let pdfResolucionUrl = formData.pdfResolucion || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfResolucionUrl = await uploadPDF(pdfFile, `com12_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom12 = {
          entidadId,
          ...formData,
          pdfResolucion: pdfResolucionUrl
        };

        if (formData.recordId12) {
          // Update existing
          const updatedRecord = await com12DelegadoProteccionDatosService.update(formData.recordId12, dataCom12);
          console.log('Com12 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com12DelegadoProteccionDatosService.create(dataCom12);
          console.log('Com12 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId12: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com13 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 13) {
        console.log('guardarProgreso Com13:', formData.recordId13);
        
        // Upload PDF if needed
        let pdfConvenioUrl = formData.pdfConvenio || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfConvenioUrl = await uploadPDF(pdfFile, `com13_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom13 = {
          entidadId,
          ...formData,
          pdfConvenio: pdfConvenioUrl
        };

        if (formData.recordId13) {
          // Update existing
          const updatedRecord = await com13IntegracionPlataformaService.update(formData.recordId13, dataCom13);
          console.log('Com13 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com13IntegracionPlataformaService.create(dataCom13);
          console.log('Com13 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId13: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com14 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 14) {
        console.log('guardarProgreso Com14:', formData.recordId14);
        
        // Upload PDF if needed
        let pdfResolucionUrl = formData.pdfResolucion || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfResolucionUrl = await uploadPDF(pdfFile, `com14_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom14 = {
          entidadId,
          ...formData,
          pdfResolucion: pdfResolucionUrl
        };

        if (formData.recordId14) {
          // Update existing
          const updatedRecord = await com14OficialSeguridadInfoService.update(formData.recordId14, dataCom14);
          console.log('Com14 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com14OficialSeguridadInfoService.create(dataCom14);
          console.log('Com14 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId14: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com15 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 15) {
        console.log('guardarProgreso Com15:', formData.recordId15);
        
        // Upload PDF if needed
        let pdfResolucionUrl = formData.pdfResolucion || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfResolucionUrl = await uploadPDF(pdfFile, `com15_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom15 = {
          entidadId,
          ...formData,
          pdfResolucion: pdfResolucionUrl
        };

        if (formData.recordId15) {
          // Update existing
          const updatedRecord = await com15CsirtService.update(formData.recordId15, dataCom15);
          console.log('Com15 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com15CsirtService.create(dataCom15);
          console.log('Com15 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId15: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com16 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 16) {
        console.log('guardarProgreso Com16:', formData.recordId16);
        
        // Upload PDF if needed
        let pdfSgsiUrl = formData.pdfSgsi || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfSgsiUrl = await uploadPDF(pdfFile, `com16_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        // Upload second PDF for Com16
        let pdfCertificacionUrl = formData.pdfCertificacion || null;
        if (pdfUrl2 && pdfUrl2.startsWith('blob:')) {
          const pdfFile2 = await fetch(pdfUrl2).then(r => r.blob());
          pdfCertificacionUrl = await uploadPDF(pdfFile2, `com16_cert_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl2);
          setPdfUrl2(null);
        }

        const dataCom16 = {
          entidadId,
          ...formData,
          pdfSgsi: pdfSgsiUrl,
          pdfCertificacion: pdfCertificacionUrl
        };

        if (formData.recordId16) {
          // Update existing
          const updatedRecord = await com16SgsiService.update(formData.recordId16, dataCom16);
          console.log('Com16 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com16SgsiService.create(dataCom16);
          console.log('Com16 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId16: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com17 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 17) {
        console.log('guardarProgreso Com17:', formData.recordId17);
        
        // Upload PDF if needed
        let pdfPlanUrl = formData.pdfPlan || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfPlanUrl = await uploadPDF(pdfFile, `com17_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom17 = {
          entidadId,
          ...formData,
          pdfPlan: pdfPlanUrl
        };

        if (formData.recordId17) {
          // Update existing
          const updatedRecord = await com17PlanContinuidadService.update(formData.recordId17, dataCom17);
          console.log('Com17 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com17PlanContinuidadService.create(dataCom17);
          console.log('Com17 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId17: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com18 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 18) {
        console.log('guardarProgreso Com18:', formData.recordId18);
        
        // Upload PDF if needed
        let pdfOficioUrl = formData.pdfOficio || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfOficioUrl = await uploadPDF(pdfFile, `com18_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom18 = {
          entidadId,
          ...formData,
          pdfOficio: pdfOficioUrl
        };

        if (formData.recordId18) {
          // Update existing
          const updatedRecord = await com18PagoLineasService.update(formData.recordId18, dataCom18);
          console.log('Com18 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com18PagoLineasService.create(dataCom18);
          console.log('Com18 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId18: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com19 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 19) {
        console.log('guardarProgreso Com19:', formData.recordId19);
        
        // Upload PDF if needed
        let pdfReporteUrl = formData.pdfReporte || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfReporteUrl = await uploadPDF(pdfFile, `com19_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom19 = {
          entidadId,
          ...formData,
          pdfReporte: pdfReporteUrl
        };

        if (formData.recordId19) {
          // Update existing
          const updatedRecord = await com19AperturaDatosService.update(formData.recordId19, dataCom19);
          console.log('Com19 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com19AperturaDatosService.create(dataCom19);
          console.log('Com19 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId19: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com20 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 20) {
        console.log('guardarProgreso Com20:', formData.recordId20);
        
        // Upload PDF if needed
        let pdfReporteUrl = formData.pdfReporte || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfReporteUrl = await uploadPDF(pdfFile, `com20_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom20 = {
          entidadId,
          ...formData,
          pdfReporte: pdfReporteUrl
        };

        if (formData.recordId20) {
          // Update existing
          const updatedRecord = await com20DigitalizacionTramitesService.update(formData.recordId20, dataCom20);
          console.log('Com20 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com20DigitalizacionTramitesService.create(dataCom20);
          console.log('Com20 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId20: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }

      // Com21 - guardarProgreso
      else if (parseInt(formData.compromisoId) === 21) {
        console.log('guardarProgreso Com21:', formData.recordId21);
        
        // Upload PDF if needed
        let pdfResolucionUrl = formData.pdfResolucion || null;
        if (pdfUrl && pdfUrl.startsWith('blob:')) {
          const pdfFile = await fetch(pdfUrl).then(r => r.blob());
          pdfResolucionUrl = await uploadPDF(pdfFile, `com21_${entidadId}_${Date.now()}.pdf`);
          URL.revokeObjectURL(pdfUrl);
          setPdfUrl(null);
        }

        const dataCom21 = {
          entidadId,
          ...formData,
          pdfResolucion: pdfResolucionUrl
        };

        if (formData.recordId21) {
          // Update existing
          const updatedRecord = await com21OficialGobiernoDatosService.update(formData.recordId21, dataCom21);
          console.log('Com21 updated:', updatedRecord);
        } else {
          // Create new
          const newRecord = await com21OficialGobiernoDatosService.create(dataCom21);
          console.log('Com21 created:', newRecord);
          setFormData(prev => ({ ...prev, recordId21: newRecord.id }));
        }

        // Update criteriosEvaluados
        const criteriosActuales = typeof compromisoSeleccionado.criteriosEvaluados === 'string'
          ? JSON.parse(compromisoSeleccionado.criteriosEvaluados)
          : compromisoSeleccionado.criteriosEvaluados || {};
        criteriosActuales[pasoActual] = true;

        await updateCriteriosEvaluados(
          compromisoSeleccionado.id,
          JSON.stringify(criteriosActuales)
        );
      }