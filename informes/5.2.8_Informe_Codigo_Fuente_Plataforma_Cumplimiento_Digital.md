# 5.2.8 Informe del Código Fuente de la Plataforma de Cumplimiento Digital

**Documento:** Informe Técnico de Arquitectura y Código Fuente  
**Proyecto:** Plataforma de Cumplimiento Digital (PCM)  
**Versión:** 1.0  
**Fecha:** 29 de diciembre de 2025  
**Elaborado por:** Equipo de Desarrollo  

---

## 1. Resumen Ejecutivo

El presente informe documenta la arquitectura de software, estructura del código fuente y tecnologías implementadas en la **Plataforma de Cumplimiento Digital (PCM)**. Este sistema integral ha sido desarrollado para la gestión de cumplimiento normativo y gobierno digital en entidades públicas del Perú, siguiendo estándares de desarrollo modernos y patrones arquitectónicos reconocidos en la industria.

---

## 2. Stack Tecnológico

### 2.1 Backend

| Tecnología | Versión | Descripción |
|------------|---------|-------------|
| **.NET** | 9.0 | Framework principal de desarrollo |
| **ASP.NET Core** | 9.0 | Framework web para APIs RESTful |
| **Entity Framework Core** | 9.0.10 | ORM para acceso a datos |
| **PostgreSQL** | 15+ | Sistema de gestión de base de datos relacional |
| **Npgsql** | 9.0.4 | Proveedor ADO.NET para PostgreSQL |
| **MediatR** | 13.1.0 | Librería para implementación de CQRS |
| **AutoMapper** | 15.1.0 | Mapeo objeto-objeto |
| **FluentValidation** | 12.1.0 | Validación de entradas |
| **BCrypt.Net-Next** | 4.0.3 | Hashing seguro de contraseñas |
| **JWT Bearer** | 9.0.10 | Autenticación basada en tokens |
| **Swashbuckle** | 9.0.6 | Documentación OpenAPI/Swagger |

### 2.2 Frontend

| Tecnología | Versión | Descripción |
|------------|---------|-------------|
| **React** | 19.1.1 | Biblioteca para interfaces de usuario |
| **Vite** | 7.1.7 | Build tool y servidor de desarrollo |
| **Tailwind CSS** | 3.4.18 | Framework CSS utility-first |
| **React Router DOM** | 7.9.5 | Enrutamiento del lado del cliente |
| **Axios** | 1.13.1 | Cliente HTTP |
| **Recharts** | 3.6.0 | Visualización de datos |
| **Lucide React** | 0.552.0 | Librería de iconos |
| **react-google-recaptcha-v3** | 1.11.0 | Integración reCAPTCHA |
| **react-hot-toast** | 2.6.0 | Notificaciones toast |

### 2.3 Infraestructura y DevOps

| Tecnología | Descripción |
|------------|-------------|
| **Docker** | Containerización de aplicaciones |
| **Nginx** | Servidor web y proxy reverso |
| **Git** | Control de versiones |
| **GitHub** | Repositorio de código fuente |

---

## 3. Arquitectura del Sistema

### 3.1 Patrón Arquitectónico: Clean Architecture

El backend implementa **Clean Architecture** (Arquitectura Limpia) combinada con el patrón **CQRS** (Command Query Responsibility Segregation). Esta arquitectura garantiza:

- **Separación de responsabilidades**: Cada capa tiene una función específica
- **Independencia de frameworks**: El núcleo de negocio no depende de frameworks externos
- **Testabilidad**: Facilita pruebas unitarias y de integración
- **Mantenibilidad**: Código modular y fácil de mantener

```
┌─────────────────────────────────────────────────────────────────┐
│                        PRESENTATION LAYER                        │
│                          (PCM.API)                               │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ Controllers │  │   Swagger   │  │    JWT Authentication   │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                       APPLICATION LAYER                          │
│                      (PCM.Application)                           │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │  Commands   │  │   Queries   │  │         DTOs            │  │
│  │  (MediatR)  │  │  (MediatR)  │  │     (AutoMapper)        │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    Interfaces                           │    │
│  │   IAuthService, IJwtTokenService, IEmailService, etc.   │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      INFRASTRUCTURE LAYER                        │
│                     (PCM.Infrastructure)                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │  DbContext  │  │  Handlers   │  │       Services          │  │
│  │ (EF Core)   │  │ (MediatR)   │  │ AuthService, JwtService │  │
│  └─────────────┘  └─────────────┘  └─────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         DOMAIN LAYER                             │
│                        (PCM.Domain)                              │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                       Entities                          │    │
│  │  Usuario, Entidad, CompromisoGobiernoDigital,          │    │
│  │  CumplimientoNormativo, CumplimientoHistorial, etc.    │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                         DATABASE                                 │
│                       (PostgreSQL)                               │
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 Arquitectura Frontend: Component-Based Architecture

El frontend implementa una arquitectura basada en componentes con React, siguiendo principios de:

- **Single Responsibility**: Cada componente tiene una única responsabilidad
- **Reusabilidad**: Componentes reutilizables en múltiples contextos
- **Separación de estado**: Uso de Context API para estado global
- **Service Layer**: Capa de servicios para comunicación con API

```
┌─────────────────────────────────────────────────────────────────┐
│                          REACT APP                               │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                      App.jsx                            │    │
│  │              (Router + AuthProvider)                    │    │
│  └─────────────────────────────────────────────────────────┘    │
│                              │                                   │
│  ┌───────────────────────────┼───────────────────────────┐      │
│  │                           ▼                           │      │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │      │
│  │  │   Layouts   │  │    Pages    │  │ Components  │   │      │
│  │  └─────────────┘  └─────────────┘  └─────────────┘   │      │
│  │                                                       │      │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐   │      │
│  │  │   Context   │  │    Hooks    │  │   Services  │   │      │
│  │  │ (AuthCtx)   │  │(useAuth,etc)│  │  (API calls)│   │      │
│  │  └─────────────┘  └─────────────┘  └─────────────┘   │      │
│  └───────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. Estructura de Carpetas del Proyecto

### 4.1 Estructura General

```
PCM/
├── backend/                    # Código fuente del backend
│   ├── PCM.sln                # Solución de Visual Studio
│   ├── PCM.API/               # Capa de presentación (Web API)
│   ├── PCM.Application/       # Capa de aplicación (CQRS)
│   ├── PCM.Domain/            # Capa de dominio (Entidades)
│   ├── PCM.Infrastructure/    # Capa de infraestructura
│   ├── PCM.Shared/            # Utilidades compartidas
│   └── HashGenerator/         # Utilidad para generación de hashes
├── frontend/                  # Código fuente del frontend
│   ├── src/                   # Código fuente React
│   ├── public/               # Recursos estáticos
│   └── package.json          # Dependencias npm
├── db/                        # Scripts SQL y migraciones
├── deploy/                    # Configuración de despliegue
├── docs/                      # Documentación técnica
├── informes/                  # Informes del proyecto
├── Dockerfile                 # Contenedor Docker para backend
└── README.md                  # Documentación principal
```

### 4.2 Backend - Detalle por Proyecto

#### PCM.API (Capa de Presentación)
```
PCM.API/
├── Controllers/               # Controladores REST API
│   ├── AuthController.cs      # Autenticación y autorización
│   ├── UsuariosController.cs  # Gestión de usuarios
│   ├── EntidadesController.cs # Gestión de entidades
│   ├── DashboardController.cs # Indicadores y métricas
│   ├── Com1LiderGTDController.cs      # Compromiso 1
│   ├── Com2CGTDController.cs          # Compromiso 2
│   ├── Com3EPGDController.cs          # Compromiso 3
│   │   ... (21 compromisos de gobierno digital)
│   └── CumplimientoHistorialController.cs
├── Properties/                # Configuración de lanzamiento
├── appsettings.json          # Configuración general
├── appsettings.Development.json
├── appsettings.Production.json
└── Program.cs                # Punto de entrada y configuración
```

#### PCM.Application (Capa de Aplicación)
```
PCM.Application/
├── Commands/                  # Comandos CQRS (escritura)
├── Queries/                   # Consultas CQRS (lectura)
├── DTOs/                      # Data Transfer Objects
│   ├── Auth/                  # DTOs de autenticación
│   ├── Usuario/               # DTOs de usuarios
│   ├── Entidad/               # DTOs de entidades
│   └── ...
├── Features/                  # Funcionalidades por dominio
│   ├── Usuarios/              # Feature de usuarios
│   │   ├── Commands/
│   │   └── Queries/
│   ├── Com1LiderGTD/          # Feature Compromiso 1
│   ├── Com2CGTD/              # Feature Compromiso 2
│   │   ... (21 compromisos)
│   └── Dashboard/
├── Interfaces/                # Contratos de servicios
│   ├── IAuthService.cs
│   ├── IJwtTokenService.cs
│   ├── IEmailService.cs
│   └── ICumplimientoHistorialService.cs
├── Catalogos/                 # Servicios de catálogos
└── Common/                    # Utilidades comunes
    └── Result.cs              # Patrón Result para manejo de errores
```

#### PCM.Domain (Capa de Dominio)
```
PCM.Domain/
└── Entities/                  # Entidades del dominio
    ├── Usuario.cs             # Entidad Usuario
    ├── Entidad.cs             # Entidad pública
    ├── Perfil.cs              # Perfiles de usuario
    ├── CompromisoGobiernoDigital.cs  # Compromisos
    ├── CumplimientoNormativo.cs      # Cumplimiento
    ├── CumplimientoHistorial.cs      # Historial de cambios
    ├── Com1LiderGTD.cs        # Líder de Gobierno Digital
    ├── Com2CGTD.cs            # Comité de Gobierno Digital
    │   ... (21 entidades de compromisos)
    ├── Ubigeo.cs              # División geográfica
    ├── Sector.cs              # Sectores gubernamentales
    └── MarcoNormativo.cs      # Marco normativo
```

#### PCM.Infrastructure (Capa de Infraestructura)
```
PCM.Infrastructure/
├── Data/
│   └── PCMDbContext.cs        # Entity Framework DbContext
├── Handlers/                  # Handlers de MediatR
│   ├── Usuarios/
│   ├── Entidades/
│   └── ...
└── Services/                  # Implementación de servicios
    ├── AuthService.cs         # Servicio de autenticación
    ├── JwtTokenService.cs     # Generación de tokens JWT
    ├── ReCaptchaService.cs    # Validación reCAPTCHA
    ├── ResendEmailService.cs  # Envío de correos
    ├── CumplimientoHistorialService.cs
    └── SunatService.cs        # Integración SUNAT
```

### 4.3 Frontend - Detalle de Estructura

```
frontend/src/
├── App.jsx                    # Componente raíz con rutas
├── main.jsx                   # Punto de entrada
├── index.css                  # Estilos globales
├── components/                # Componentes reutilizables
│   ├── ProtectedRoute.jsx     # HOC para rutas protegidas
│   ├── ProtectedAction.jsx    # HOC para acciones protegidas
│   ├── ConsultaBadge.jsx      # Badge de estado
│   ├── PDFViewer.jsx          # Visor de PDFs
│   ├── Compromiso3/           # Componentes específicos
│   ├── Compromiso10/
│   └── Evaluacion/
├── pages/                     # Páginas/Vistas
│   ├── Login.jsx              # Inicio de sesión
│   ├── Dashboard.jsx          # Panel principal
│   ├── Usuarios.jsx           # Gestión de usuarios
│   ├── Entidades.jsx          # Gestión de entidades
│   ├── CompromisoGobiernoDigital.jsx
│   ├── CumplimientoNormativo.jsx
│   ├── CumplimientoNormativoDetalle.jsx
│   ├── EvaluacionCumplimiento.jsx
│   ├── HistorialCumplimiento.jsx
│   ├── MarcoNormativo.jsx
│   ├── Reportes.jsx
│   ├── ForgotPassword.jsx
│   └── ResetPassword.jsx
├── layouts/                   # Layouts de la aplicación
│   └── DashboardLayout.jsx    # Layout del dashboard
├── context/                   # React Context
│   ├── AuthContext.jsx        # Contexto de autenticación
│   └── authContextConfig.js
├── hooks/                     # Custom Hooks
│   ├── useAuth.js             # Hook de autenticación
│   └── usePermissions.js      # Hook de permisos
├── services/                  # Capa de servicios API
│   ├── api.js                 # Configuración Axios
│   ├── authService.js         # Servicio de auth
│   ├── usuariosService.js     # Servicio de usuarios
│   ├── entidadesService.js    # Servicio de entidades
│   ├── com1LiderGTDService.js  # Servicio Compromiso 1
│   │   ... (21 servicios de compromisos)
│   └── dashboardService.js
├── config/                    # Configuración
└── utils/                     # Utilidades
```

---

## 5. Diagrama de Clases del Dominio

### 5.1 Entidades Principales

```
┌─────────────────────────────────────────────────────────────────┐
│                           USUARIO                                │
├─────────────────────────────────────────────────────────────────┤
│ + UserId: Guid                                                   │
│ + Email: string                                                  │
│ + Password: string (hashed)                                      │
│ + NumDni: string                                                 │
│ + Nombres: string                                                │
│ + ApePaterno: string                                             │
│ + ApeMaterno: string                                             │
│ + Direccion: string?                                             │
│ + EntidadId: Guid?                                               │
│ + PerfilId: int                                                  │
│ + Activo: bool                                                   │
│ + LastLogin: DateTime?                                           │
│ + ResetPasswordToken: string?                                    │
│ + ResetPasswordExpiry: DateTime?                                 │
│ + CreatedAt: DateTime                                            │
│ + UpdatedAt: DateTime                                            │
├─────────────────────────────────────────────────────────────────┤
│ + Entidad: Entidad (navigation)                                  │
│ + Perfil: Perfil (navigation)                                    │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ N:1
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                           ENTIDAD                                │
├─────────────────────────────────────────────────────────────────┤
│ + EntidadId: Guid                                                │
│ + Ruc: string                                                    │
│ + Nombre: string                                                 │
│ + Direccion: string?                                             │
│ + UbigeoId: Guid?                                                │
│ + NivelGobiernoId: int?                                          │
│ + SectorId: int?                                                 │
│ + ClasificacionId: long?                                         │
│ + Telefono: string?                                              │
│ + Email: string?                                                 │
│ + Web: string?                                                   │
│ + NombreAlcalde: string?                                         │
│ + ApePatAlcalde: string?                                         │
│ + ApeMatAlcalde: string?                                         │
│ + EmailAlcalde: string?                                          │
│ + Activo: bool                                                   │
│ + CreatedAt: DateTime                                            │
│ + UpdatedAt: DateTime                                            │
├─────────────────────────────────────────────────────────────────┤
│ + Ubigeo: Ubigeo (navigation)                                    │
│ + NivelGobierno: NivelGobierno (navigation)                      │
│ + Sector: Sector (navigation)                                    │
│ + Clasificacion: Subclasificacion (navigation)                   │
│ + Usuarios: ICollection<Usuario>                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ 1:N
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                   CUMPLIMIENTO_NORMATIVO                         │
├─────────────────────────────────────────────────────────────────┤
│ + CumplimientoId: long                                           │
│ + EntidadId: Guid                                                │
│ + CompromisoId: long                                             │
│ + Anio: int                                                      │
│ + EstadoId: int                                                  │
│ + Observacion: string?                                           │
│ + FechaEnvio: DateTime?                                          │
│ + FechaAprobacion: DateTime?                                     │
│ + CreatedAt: DateTime                                            │
│ + UpdatedAt: DateTime                                            │
├─────────────────────────────────────────────────────────────────┤
│ + Entidad: Entidad (navigation)                                  │
│ + Compromiso: CompromisoGobiernoDigital (navigation)             │
│ + Estado: EstadoCompromiso (navigation)                          │
│ + Historial: ICollection<CumplimientoHistorial>                  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ N:1
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                COMPROMISO_GOBIERNO_DIGITAL                       │
├─────────────────────────────────────────────────────────────────┤
│ + CompromisoId: long                                             │
│ + NombreCompromiso: string                                       │
│ + Descripcion: string?                                           │
│ + Alcances: string (JSON)                                        │
│ + FechaInicio: DateTime                                          │
│ + FechaFin: DateTime                                             │
│ + Estado: int                                                    │
│ + Activo: bool                                                   │
│ + CreatedAt: DateTime                                            │
│ + UpdatedAt: DateTime?                                           │
├─────────────────────────────────────────────────────────────────┤
│ + Normativas: ICollection<CompromisoNormativa>                   │
│ + CriteriosEvaluacion: ICollection<CriterioEvaluacion>           │
│ + AlcancesCompromisos: ICollection<AlcanceCompromiso>            │
└─────────────────────────────────────────────────────────────────┘
```

### 5.2 Entidades de Compromisos de Gobierno Digital

El sistema implementa 21 compromisos de Gobierno Digital, cada uno con su entidad específica:

| # | Entidad | Descripción |
|---|---------|-------------|
| 1 | `Com1LiderGTD` | Líder de Gobierno y Transformación Digital |
| 2 | `Com2CGTD` | Comité de Gobierno y Transformación Digital |
| 3 | `Com3EPGD` | Equipo de Proyectos de Gobierno Digital |
| 4 | `Com4PEI` | Plan Estratégico Institucional |
| 5 | `Com5EstrategiaDigital` | Estrategia Digital Institucional |
| 6 | `Com6MigracionGobPe` | Migración a GOB.PE |
| 7 | `Com7ImplementacionMPD` | Implementación Mesa de Partes Digital |
| 8 | `Com8PublicacionTUPA` | Publicación TUPA Digital |
| 9 | `Com9ModeloGestionDocumental` | Modelo de Gestión Documental |
| 10 | `Com10DatosAbiertos` | Datos Abiertos |
| 11 | `Com11AportacionGeoPeru` | Aportación a GeoPERÚ |
| 12 | `Com12ResponsableSoftwarePublico` | Responsable de Software Público |
| 13 | `Com13InteroperabilidadPIDE` | Interoperabilidad PIDE |
| 14 | `Com14OficialSeguridadDigital` | Oficial de Seguridad Digital |
| 15 | `Com15CSIRTInstitucional` | CSIRT Institucional |
| 16 | `Com16SistemaGestionSeguridad` | Sistema de Gestión de Seguridad |
| 17 | `Com17PlanTransicionIPv6` | Plan de Transición IPv6 |
| 18 | `Com18AccesoPortalTransparencia` | Acceso Portal de Transparencia |
| 19 | `Com19EncuestaNacionalGobDigital` | Encuesta Nacional de Gobierno Digital |
| 20 | `Com20DigitalizacionServiciosFacilita` | Digitalización Servicios Facilita |
| 21 | `Com21OficialGobiernoDatos` | Oficial de Gobierno de Datos |

### 5.3 Diagrama de Relaciones (ERD Simplificado)

```
┌──────────────┐       ┌──────────────┐       ┌──────────────┐
│    PERFIL    │       │    SECTOR    │       │  UBIGEO      │
├──────────────┤       ├──────────────┤       ├──────────────┤
│ PerfilId     │       │ SectorId     │       │ UbigeoId     │
│ Nombre       │       │ Nombre       │       │ Departamento │
│ Descripcion  │       │ Descripcion  │       │ Provincia    │
└──────┬───────┘       └──────┬───────┘       │ Distrito     │
       │                      │               └──────┬───────┘
       │ 1                    │ 1                    │ 1
       │                      │                      │
       │ N                    │ N                    │ N
┌──────┴───────┐       ┌──────┴──────────────┬──────┴───────┐
│   USUARIO    │───N:1─│      ENTIDAD        │              │
├──────────────┤       ├─────────────────────┤              │
│ UserId       │       │ EntidadId           │              │
│ Email        │       │ Ruc                 │              │
│ PerfilId(FK) │       │ Nombre              │              │
│ EntidadId(FK)│       │ SectorId(FK)        │              │
└──────────────┘       │ UbigeoId(FK)        │              │
                       │ NivelGobiernoId(FK) │              │
                       └─────────┬───────────┘              │
                                 │ 1                        │
                                 │                          │
                                 │ N                        │
                       ┌─────────┴───────────┐              │
                       │ CUMPLIMIENTO_NORM   │              │
                       ├─────────────────────┤              │
                       │ CumplimientoId      │              │
                       │ EntidadId(FK)       │              │
                       │ CompromisoId(FK)    │              │
                       │ EstadoId(FK)        │              │
                       │ Anio                │              │
                       └─────────┬───────────┘              │
                                 │ N                        │
                                 │                          │
                                 │ 1                        │
                       ┌─────────┴───────────┐              │
                       │ COMPROMISO_GOB_DIG  │              │
                       ├─────────────────────┤              │
                       │ CompromisoId        │              │
                       │ NombreCompromiso    │              │
                       │ Descripcion         │              │
                       │ Alcances            │              │
                       └─────────────────────┘              │
                                                            │
┌──────────────┐       ┌─────────────────────┐              │
│NIVEL_GOBIERNO│───1:N─│                     │──────────────┘
├──────────────┤       │                     │
│ NivelGobId   │       │                     │
│ Nombre       │       │                     │
└──────────────┘       └─────────────────────┘
```

---

## 6. Patrones de Diseño Implementados

### 6.1 Backend

| Patrón | Descripción | Implementación |
|--------|-------------|----------------|
| **Repository Pattern** | Abstracción de acceso a datos | Entity Framework DbContext |
| **CQRS** | Separación de comandos y consultas | MediatR Commands/Queries |
| **Mediator** | Desacoplamiento de componentes | MediatR |
| **DTO Pattern** | Transferencia de datos entre capas | AutoMapper |
| **Result Pattern** | Manejo consistente de errores | `Result<T>` class |
| **Dependency Injection** | Inversión de control | Built-in DI de ASP.NET Core |
| **Options Pattern** | Configuración tipada | IOptions<T> |

### 6.2 Frontend

| Patrón | Descripción | Implementación |
|--------|-------------|----------------|
| **Container/Presentational** | Separación de lógica y vista | Pages vs Components |
| **Context API** | Estado global | AuthContext |
| **Custom Hooks** | Reutilización de lógica | useAuth, usePermissions |
| **Service Layer** | Abstracción de API calls | services/*.js |
| **Protected Route** | Control de acceso | ProtectedRoute.jsx |
| **Higher-Order Component** | Composición de componentes | ProtectedAction.jsx |

---

## 7. Flujo de Autenticación y Autorización

### 7.1 Proceso de Autenticación

```
┌─────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  User   │     │  Frontend   │     │   Backend   │     │  Database   │
└────┬────┘     └──────┬──────┘     └──────┬──────┘     └──────┬──────┘
     │                 │                   │                   │
     │  1. Login       │                   │                   │
     │────────────────>│                   │                   │
     │                 │  2. POST /auth/login                  │
     │                 │──────────────────>│                   │
     │                 │                   │  3. Validate User │
     │                 │                   │──────────────────>│
     │                 │                   │<──────────────────│
     │                 │                   │  4. Generate JWT  │
     │                 │<──────────────────│                   │
     │  5. Store Token │                   │                   │
     │<────────────────│                   │                   │
     │                 │                   │                   │
     │  6. Access Page │                   │                   │
     │────────────────>│                   │                   │
     │                 │  7. API Call + Bearer Token           │
     │                 │──────────────────>│                   │
     │                 │                   │  8. Validate JWT  │
     │                 │                   │  9. Check Perms   │
     │                 │<──────────────────│                   │
     │  10. Response   │                   │                   │
     │<────────────────│                   │                   │
```

### 7.2 Estructura del Token JWT

```json
{
  "sub": "user-guid",
  "email": "usuario@entidad.gob.pe",
  "nombre": "Nombre Usuario",
  "perfil": "Operador PCM",
  "perfilId": "2",
  "entidadId": "entidad-guid",
  "entidadNombre": "Nombre Entidad",
  "permisos": ["usuarios.ver", "cumplimiento.editar", ...],
  "exp": 1735500000,
  "iss": "PCM-API",
  "aud": "PCM-Frontend"
}
```

---

## 8. API REST Endpoints

### 8.1 Endpoints Principales

| Método | Endpoint | Descripción |
|--------|----------|-------------|
| POST | `/api/auth/login` | Iniciar sesión |
| POST | `/api/auth/refresh` | Renovar token |
| POST | `/api/auth/logout` | Cerrar sesión |
| GET | `/api/usuarios` | Listar usuarios |
| POST | `/api/usuarios` | Crear usuario |
| GET | `/api/entidades` | Listar entidades |
| GET | `/api/compromisos` | Listar compromisos |
| GET | `/api/cumplimiento` | Listar cumplimientos |
| POST | `/api/cumplimiento` | Registrar cumplimiento |
| GET | `/api/dashboard/resumen` | Resumen del dashboard |

### 8.2 Endpoints por Compromiso

Cada compromiso (1-21) tiene sus propios endpoints CRUD:

```
/api/com1-lider-gtd
/api/com2-cgtd
/api/com3-epgd
... (hasta compromiso 21)
/api/com21-oficial-gobierno-datos
```

---

## 9. Seguridad Implementada

### 9.1 Medidas de Seguridad

| Medida | Implementación |
|--------|----------------|
| **Autenticación** | JWT Bearer Tokens |
| **Hashing de Contraseñas** | BCrypt con salt |
| **Protección CSRF** | Token-based auth |
| **reCAPTCHA v3** | Protección contra bots |
| **CORS** | Configuración restrictiva |
| **Rate Limiting** | Implementación en nginx |
| **HTTPS** | Certificados SSL/TLS |
| **Input Validation** | FluentValidation |
| **SQL Injection Prevention** | Entity Framework (parameterized queries) |

### 9.2 Sistema de Permisos

El sistema implementa control de acceso basado en roles (RBAC):

- **Administrador SGTD**: Acceso completo al sistema
- **Operador PCM**: Gestión de cumplimientos y evaluaciones
- **Entidad**: Registro de información de compromisos

---

## 10. Configuración de Despliegue

### 10.1 Contenedor Docker

El backend se despliega mediante contenedor Docker con la siguiente configuración:

```dockerfile
# Multi-stage build
FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
FROM mcr.microsoft.com/dotnet/aspnet:9.0 AS runtime
```

### 10.2 Variables de Entorno Requeridas

| Variable | Descripción |
|----------|-------------|
| `ConnectionStrings__DefaultConnection` | Cadena de conexión PostgreSQL |
| `Jwt__Secret` | Clave secreta para JWT |
| `Jwt__Issuer` | Emisor del token |
| `Jwt__Audience` | Audiencia del token |
| `ReCaptcha__SecretKey` | Clave secreta reCAPTCHA |
| `Resend__ApiKey` | API key para envío de correos |

---

## 11. Gestión del Código Fuente con Git

### 11.1 Sistema de Control de Versiones

El código fuente de la Plataforma de Cumplimiento Digital se gestiona mediante **Git** como sistema de control de versiones distribuido, siguiendo las mejores prácticas de desarrollo colaborativo.

#### Características de Git implementadas:

| Característica | Descripción |
|----------------|-------------|
| **Versionamiento** | Control completo de cambios en el código |
| **Branching** | Gestión de ramas para desarrollo paralelo |
| **Historial** | Registro detallado de todos los commits |
| **Colaboración** | Soporte para múltiples desarrolladores |
| **Rollback** | Capacidad de revertir cambios si es necesario |

### 11.2 Estructura del Repositorio Git

```
PCM/                              # Repositorio raíz
├── .git/                         # Directorio de Git (control de versiones)
├── .gitignore                    # Archivos excluidos del versionamiento
├── README.md                     # Documentación principal
├── backend/                      # Código fuente .NET
├── frontend/                     # Código fuente React
├── db/                           # Scripts de base de datos
├── deploy/                       # Configuración de despliegue
├── docs/                         # Documentación técnica
└── informes/                     # Informes del proyecto
```

### 11.3 Flujo de Trabajo Git

```
┌─────────────────────────────────────────────────────────────────┐
│                     FLUJO DE TRABAJO GIT                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐ │
│   │  Local   │───>│  Stage   │───>│  Commit  │───>│   Push   │ │
│   │ Changes  │    │   (add)  │    │          │    │ (remote) │ │
│   └──────────┘    └──────────┘    └──────────┘    └──────────┘ │
│                                                                  │
│   Comandos principales utilizados:                               │
│   • git add .           - Preparar cambios                       │
│   • git commit -m "..." - Confirmar cambios                      │
│   • git push            - Subir al repositorio remoto            │
│   • git pull            - Obtener cambios del remoto             │
│   • git branch          - Gestión de ramas                       │
│   • git merge           - Fusión de ramas                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 11.4 Plataforma de Alojamiento: GitHub

| Aspecto | Detalle |
|---------|---------|
| **Plataforma** | GitHub |
| **Tipo de repositorio** | Privado |
| **Visibilidad** | Restringida (solo colaboradores autorizados) |
| **Funcionalidades utilizadas** | Repositorio, Issues, Pull Requests |

### 11.5 Disponibilidad del Código Fuente

> ⚠️ **NOTA IMPORTANTE:**
> 
> **El código se encuentra actualmente en un repositorio privado (GitHub) listo para ser clonado al repositorio institucional una vez que la SGTD proporcione las credenciales de acceso solicitadas.**
>
> #### Proceso de transferencia del código:
> 
> 1. **Recepción de credenciales**: La SGTD proporciona acceso al repositorio institucional
> 2. **Clonación**: Se clona el repositorio completo con todo el historial
> 3. **Configuración de remoto**: Se configura el nuevo repositorio como remoto
> 4. **Push completo**: Se transfiere todo el código con historial de commits
> 5. **Verificación**: Se valida la integridad de la transferencia
>
> #### La transferencia incluirá:
> - ✅ Historial completo de commits (trazabilidad de cambios)
> - ✅ Todas las ramas de desarrollo
> - ✅ Código fuente del backend (.NET 9.0)
> - ✅ Código fuente del frontend (React 19)
> - ✅ Scripts de base de datos (PostgreSQL)
> - ✅ Configuraciones de despliegue (Docker, Nginx)
> - ✅ Documentación técnica completa
> - ✅ Informes del proyecto

### 11.6 Métricas del Repositorio

| Métrica | Valor |
|---------|-------|
| **Sistema de control de versiones** | Git |
| **Plataforma de alojamiento** | GitHub (privado) |
| **Lenguajes principales** | C# (.NET), JavaScript (React) |
| **Archivos de código** | ~200+ archivos |
| **Entidades de dominio** | 60+ entidades |
| **Controladores API** | 37 controladores |
| **Servicios Frontend** | 39 servicios |
| **Páginas/Vistas** | 14 páginas |
| **Proyectos .NET** | 5 proyectos (API, Application, Domain, Infrastructure, Shared) |

---

## 12. Conclusiones

La Plataforma de Cumplimiento Digital ha sido desarrollada siguiendo estándares modernos de arquitectura de software:

1. **Clean Architecture**: Garantiza mantenibilidad y escalabilidad a largo plazo
2. **CQRS con MediatR**: Permite separación clara de responsabilidades
3. **Tecnologías actuales**: .NET 9.0, React 19, PostgreSQL 15+
4. **Seguridad robusta**: JWT, BCrypt, reCAPTCHA, validaciones
5. **Código documentado**: Estructura clara y convenciones consistentes

El sistema está preparado para su integración con la infraestructura institucional de la PCM, pendiente únicamente de la provisión de credenciales para el repositorio institucional.

---

## Anexos

### A. Listado Completo de Entidades del Dominio

```
AccionObjetivoEntidad     Com14OficialSeguridadDigital    EstadoCompromiso
AlcanceCompromiso         Com15CSIRTInstitucional         EvaluacionRespuestaEntidad
CapacitacionSeginfo       Com16SistemaGestionSeguridad    Exigibilidad
CedaCriterios            Com17PlanTransicionIPv6          InventarioRed
CedaEvaluacionCab        Com18AccesoPortalTransparencia   InventarioServidores
CedaEvaluacionDet        Com19EncuestaNacionalGobDigital  InventarioSistemasInfo
CedaIndicadores          Com1LiderGTD                     InventarioSoftware
Clasificacion            Com20DigitalizacionServsFacilita LogAuditoria
Com10DatosAbiertos       Com21OficialGobiernoDatos        MarcoNormativo
Com11AportacionGeoPeru   Com2CGTD                         NivelGobierno
Com12ResponsableSWPublico Com3EPGD                         ObjetivoEntidad
Com13InteroperabilidadPIDE Com4PEI                         Perfil
ComiteMiembro            Com5EstrategiaDigital            PerfilPermiso
CompromisoGobiernoDigital Com6MigracionGobPe              PermisoModulo
CompromisoNormativa      Com7ImplementacionMPD            PersonalTI
CriterioEvaluacion       Com8PublicacionTUPA              ProyectoEntidad
CumplimientoHistorial    Com9ModeloGestionDocumental      Sector
CumplimientoNormativo    Entidad                          SeguridadInfo
                                                          Subclasificacion
                                                          TablaTabla
                                                          TablaTablas
                                                          TipoNorma
                                                          Ubigeo
                                                          Usuario
```

### B. Controladores de la API

```
AuthController                    Com14OficialSeguridadDigitalController
CatalogoController               Com15CSIRTInstitucionalController
CatalogosController              Com16SistemaGestionSeguridadController
Com10DatosAbiertosController     Com17PlanTransicionIPv6Controller
Com10IndicadoresCEDAController   Com18AccesoPortalTransparenciaController
Com11AportacionGeoPeruController Com19EncuestaNacionalGobDigitalController
Com12ResponsableSWPublicoController Com1LiderGTDController
Com13InteroperabilidadPIDEController Com20DigitalizacionServiciosFacilitaController
CompromisoGobiernoDigitalController Com21OficialGobiernoDatosController
CumplimientoHistorialController  Com2CGTDController
CumplimientoNormativoController  Com3EPGDController
DashboardController              Com4PEIController
EmailController                  Com5EstrategiaDigitalController
EntidadesController              Com6MigracionGobPeController
EvaluacionController             Com7ImplementacionMPDController
EvaluacionCriteriosController    Com8PublicacionTUPAController
MarcoNormativoController         Com9ModeloGestionDocumentalController
PermisosController               UbigeoController
UsuariosController
```

---

*Documento generado el 29 de diciembre de 2025*  
*Plataforma de Cumplimiento Digital - PCM*
