
      // COMPROMISO 11: AportacionGeoPeru
      if (compromisoId === 11 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 11, user.entidadId);
        const response = await com11AportacionGeoPeruService.getByEntidad(11, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom11RecordId(data.comagpEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '11',

              urlInformacionGeoespacial: data.urlInformacionGeoespacial || '',
              tipoInformacionPublicada: data.tipoInformacionPublicada || '',
              totalCapasPublicadas: data.totalCapasPublicadas || '',
              fechaUltimaActualizacionAgp: data.fechaUltimaActualizacionAgp ? data.fechaUltimaActualizacionAgp.split('T')[0] : '',
              responsableAgp: data.responsableAgp || '',
              cargoResponsableAgp: data.cargoResponsableAgp || '',
              correoResponsableAgp: data.correoResponsableAgp || '',
              telefonoResponsableAgp: data.telefonoResponsableAgp || '',
              numeroNormaAprobacionAgp: data.numeroNormaAprobacionAgp || '',
              fechaAprobacionAgp: data.fechaAprobacionAgp ? data.fechaAprobacionAgp.split('T')[0] : '',
              informacionInteroperable: data.informacionInteroperable || false,
              observacionAgp: data.observacionAgp || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfAgp) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfAgp);
              setPdfUrl(data.rutaPdfAgp);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '11' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 12: ResponsableSoftwarePublico
      if (compromisoId === 12 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 12, user.entidadId);
        const response = await com12ResponsableSoftwarePublicoService.getByEntidad(12, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom12RecordId(data.comrspEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '12',

              dniResponsableSp: data.dniResponsableSp || '',
              nombresResponsableSp: data.nombresResponsableSp || '',
              apellidosResponsableSp: data.apellidosResponsableSp || '',
              cargoResponsableSp: data.cargoResponsableSp || '',
              correoResponsableSp: data.correoResponsableSp || '',
              telefonoResponsableSp: data.telefonoResponsableSp || '',
              fechaDesignacionSp: data.fechaDesignacionSp ? data.fechaDesignacionSp.split('T')[0] : '',
              numeroResolucionSp: data.numeroResolucionSp || '',
              observacionSp: data.observacionSp || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfSp) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfSp);
              setPdfUrl(data.rutaPdfSp);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '12' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 13: InteroperabilidadPIDE
      if (compromisoId === 13 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 13, user.entidadId);
        const response = await com13InteroperabilidadPIDEService.getByEntidad(13, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom13RecordId(data.comipideEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '13',

              tipoIntegracionPide: data.tipoIntegracionPide || '',
              nombreServicioPide: data.nombreServicioPide || '',
              descripcionServicioPide: data.descripcionServicioPide || '',
              fechaInicioIntegracionPide: data.fechaInicioIntegracionPide ? data.fechaInicioIntegracionPide.split('T')[0] : '',
              urlServicioPide: data.urlServicioPide || '',
              responsableTecnicoPide: data.responsableTecnicoPide || '',
              cargoResponsablePide: data.cargoResponsablePide || '',
              correoResponsablePide: data.correoResponsablePide || '',
              telefonoResponsablePide: data.telefonoResponsablePide || '',
              convenioPide: data.convenioPide || '',
              fechaConvenioPide: data.fechaConvenioPide ? data.fechaConvenioPide.split('T')[0] : '',
              activoPide: data.activoPide || false,
              observacionPide: data.observacionPide || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfPide) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfPide);
              setPdfUrl(data.rutaPdfPide);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '13' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 14: OficialSeguridadDigital
      if (compromisoId === 14 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 14, user.entidadId);
        const response = await com14OficialSeguridadDigitalService.getByEntidad(14, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom14RecordId(data.comoscdEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '14',

              dniOscd: data.dniOscd || '',
              nombresOscd: data.nombresOscd || '',
              apellidosOscd: data.apellidosOscd || '',
              cargoOscd: data.cargoOscd || '',
              correoOscd: data.correoOscd || '',
              telefonoOscd: data.telefonoOscd || '',
              fechaDesignacionOscd: data.fechaDesignacionOscd ? data.fechaDesignacionOscd.split('T')[0] : '',
              numeroResolucionOscd: data.numeroResolucionOscd || '',
              comunicadaPcmOscd: data.comunicadaPcmOscd || false,
              observacionOscd: data.observacionOscd || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfOscd) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfOscd);
              setPdfUrl(data.rutaPdfOscd);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '14' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 15: CSIRTInstitucional
      if (compromisoId === 15 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 15, user.entidadId);
        const response = await com15CSIRTInstitucionalService.getByEntidad(15, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom15RecordId(data.comcsirtEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '15',

              nombreCsirt: data.nombreCsirt || '',
              fechaConformacionCsirt: data.fechaConformacionCsirt ? data.fechaConformacionCsirt.split('T')[0] : '',
              numeroResolucionCsirt: data.numeroResolucionCsirt || '',
              responsableCsirt: data.responsableCsirt || '',
              cargoResponsableCsirt: data.cargoResponsableCsirt || '',
              correoResponsableCsirt: data.correoResponsableCsirt || '',
              telefonoResponsableCsirt: data.telefonoResponsableCsirt || '',
              protocoloCsirt: data.protocoloCsirt || false,
              comunicadaPcmCsirt: data.comunicadaPcmCsirt || false,
              observacionCsirt: data.observacionCsirt || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfCsirt) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfCsirt);
              setPdfUrl(data.rutaPdfCsirt);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '15' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 16: SistemaGestionSeguridad
      if (compromisoId === 16 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 16, user.entidadId);
        const response = await com16SistemaGestionSeguridadService.getByEntidad(16, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom16RecordId(data.comsgsiEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '16',

              responsableSgsi: data.responsableSgsi || '',
              cargoResponsableSgsi: data.cargoResponsableSgsi || '',
              correoResponsableSgsi: data.correoResponsableSgsi || '',
              telefonoResponsableSgsi: data.telefonoResponsableSgsi || '',
              estadoSgsi: data.estadoSgsi || '',
              versionNormaSgsi: data.versionNormaSgsi || '',
              alcanceSgsi: data.alcanceSgsi || '',
              fechaInicioSgsi: data.fechaInicioSgsi ? data.fechaInicioSgsi.split('T')[0] : '',
              fechaCertificacionSgsi: data.fechaCertificacionSgsi ? data.fechaCertificacionSgsi.split('T')[0] : '',
              entidadCertificadoraSgsi: data.entidadCertificadoraSgsi || '',
              observacionSgsi: data.observacionSgsi || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfPoliticasSgsi) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfPoliticasSgsi);
              setPdfUrl(data.rutaPdfPoliticasSgsi);
            }
            // Si hay segundo documento guardado
            if (data.rutaPdfCertificacionSgsi) {
              console.log('ðŸ“„ Cargando segundo PDF guardado desde:', data.rutaPdfCertificacionSgsi);
              setPdfUrl2(data.rutaPdfCertificacionSgsi);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '16' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 17: PlanTransicionIPv6
      if (compromisoId === 17 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 17, user.entidadId);
        const response = await com17PlanTransicionIPv6Service.getByEntidad(17, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom17RecordId(data.comptipv6EntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '17',

              responsablePtipv6: data.responsablePtipv6 || '',
              cargoResponsablePtipv6: data.cargoResponsablePtipv6 || '',
              correoResponsablePtipv6: data.correoResponsablePtipv6 || '',
              telefonoResponsablePtipv6: data.telefonoResponsablePtipv6 || '',
              estadoPlanPtipv6: data.estadoPlanPtipv6 || '',
              fechaFormulacionPtipv6: data.fechaFormulacionPtipv6 ? data.fechaFormulacionPtipv6.split('T')[0] : '',
              fechaAprobacionPtipv6: data.fechaAprobacionPtipv6 ? data.fechaAprobacionPtipv6.split('T')[0] : '',
              fechaInicioPtipv6: data.fechaInicioPtipv6 ? data.fechaInicioPtipv6.split('T')[0] : '',
              fechaFinEstimadaPtipv6: data.fechaFinEstimadaPtipv6 ? data.fechaFinEstimadaPtipv6.split('T')[0] : '',
              descripcionPtipv6: data.descripcionPtipv6 || '',
              observacionPtipv6: data.observacionPtipv6 || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfPtipv6) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfPtipv6);
              setPdfUrl(data.rutaPdfPtipv6);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '17' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 18: AccesoPortalTransparencia
      if (compromisoId === 18 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 18, user.entidadId);
        const response = await com18AccesoPortalTransparenciaService.getByEntidad(18, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom18RecordId(data.comapteEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '18',

              responsableApte: data.responsableApte || '',
              cargoResponsableApte: data.cargoResponsableApte || '',
              correoResponsableApte: data.correoResponsableApte || '',
              telefonoResponsableApte: data.telefonoResponsableApte || '',
              oficioSolicitudApte: data.oficioSolicitudApte || '',
              fechaSolicitudApte: data.fechaSolicitudApte ? data.fechaSolicitudApte.split('T')[0] : '',
              fechaConcesionApte: data.fechaConcesionApte ? data.fechaConcesionApte.split('T')[0] : '',
              estadoAccesoApte: data.estadoAccesoApte || '',
              enlacePortalApte: data.enlacePortalApte || '',
              descripcionApte: data.descripcionApte || '',
              observacionApte: data.observacionApte || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfApte) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfApte);
              setPdfUrl(data.rutaPdfApte);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '18' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 19: EncuestaNacionalGobDigital
      if (compromisoId === 19 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 19, user.entidadId);
        const response = await com19EncuestaNacionalGobDigitalService.getByEntidad(19, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom19RecordId(data.comenadEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '19',

              anioEnad: data.anioEnad || '',
              responsableEnad: data.responsableEnad || '',
              cargoResponsableEnad: data.cargoResponsableEnad || '',
              correoResponsableEnad: data.correoResponsableEnad || '',
              telefonoResponsableEnad: data.telefonoResponsableEnad || '',
              fechaEnvioEnad: data.fechaEnvioEnad ? data.fechaEnvioEnad.split('T')[0] : '',
              estadoEnad: data.estadoEnad || '',
              enlaceEnad: data.enlaceEnad || '',
              observacionEnad: data.observacionEnad || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfEnad) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfEnad);
              setPdfUrl(data.rutaPdfEnad);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '19' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 20: DigitalizacionServiciosFacilita
      if (compromisoId === 20 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 20, user.entidadId);
        const response = await com20DigitalizacionServiciosFacilitaService.getByEntidad(20, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom20RecordId(data.comdsfpEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '20',

              responsableDsfp: data.responsableDsfp || '',
              cargoResponsableDsfp: data.cargoResponsableDsfp || '',
              correoResponsableDsfp: data.correoResponsableDsfp || '',
              telefonoResponsableDsfp: data.telefonoResponsableDsfp || '',
              estadoImplementacionDsfp: data.estadoImplementacionDsfp || '',
              fechaInicioDsfp: data.fechaInicioDsfp ? data.fechaInicioDsfp.split('T')[0] : '',
              fechaUltimoAvanceDsfp: data.fechaUltimoAvanceDsfp ? data.fechaUltimoAvanceDsfp.split('T')[0] : '',
              totalServiciosDigitalizadosDsfp: data.totalServiciosDigitalizadosDsfp || '',
              observacionDsfp: data.observacionDsfp || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfDsfp) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfDsfp);
              setPdfUrl(data.rutaPdfDsfp);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '20' }));
          }
          setLoading(false);
          return;
        }
      }

      // COMPROMISO 21: OficialGobiernoDatos
      if (compromisoId === 21 && user?.entidadId) {
        console.log('ðŸ“ž Llamando getByEntidad con:', 21, user.entidadId);
        const response = await com21OficialGobiernoDatosService.getByEntidad(21, user.entidadId);
        console.log('ðŸ“¦ Respuesta de getByEntidad:', response);
        
        if (response.isSuccess) {
          const data = response.data;
          console.log('ðŸ“„ Datos recibidos:', data);
          
          if (data) {
            setCom21RecordId(data.comogdEntId);
            
            // Parsear criterios evaluados desde JSON
            let criteriosParsed = [];
            if (data.criteriosEvaluados) {
              try {
                criteriosParsed = JSON.parse(data.criteriosEvaluados);
                console.log('âœ… Criterios cargados:', criteriosParsed);
              } catch (e) {
                console.error('âŒ Error al parsear criterios:', e);
              }
            }
            
            setFormData({
              compromisoId: '21',

              dniOgd: data.dniOgd || '',
              nombresOgd: data.nombresOgd || '',
              apellidosOgd: data.apellidosOgd || '',
              cargoOgd: data.cargoOgd || '',
              correoOgd: data.correoOgd || '',
              telefonoOgd: data.telefonoOgd || '',
              fechaDesignacionOgd: data.fechaDesignacionOgd ? data.fechaDesignacionOgd.split('T')[0] : '',
              numeroResolucionOgd: data.numeroResolucionOgd || '',
              comunicadaSgtdOgd: data.comunicadaSgtdOgd || false,
              observacionOgd: data.observacionOgd || '',
              documentoFile: null,
              criteriosEvaluados: criteriosParsed,
              aceptaPoliticaPrivacidad: data.checkPrivacidad || false,
              aceptaDeclaracionJurada: data.checkDdjj || false,
              estado: data.estado === 'bandeja' ? 1 : data.estado === 'sin_reportar' ? 2 : 3
            });
            
            setHaVistoPolitica(data.checkPrivacidad);
            setHaVistoDeclaracion(data.checkDdjj);
            
            // Si hay documento guardado, establecer la URL para vista previa
            if (data.rutaPdfOgd) {
              console.log('ðŸ“„ Cargando PDF guardado desde:', data.rutaPdfOgd);
              setPdfUrl(data.rutaPdfOgd);
            }
          } else {
            // No existe registro, inicializar
            setFormData(prev => ({ ...prev, compromisoId: '21' }));
          }
          setLoading(false);
          return;
        }
      }
